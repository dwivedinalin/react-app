name: CIIntegration
on:
 pull_request:
    branches: [master,develop]
  
 push:
    branches: [master,develop]

jobs:
  build:
     runs-on: ubuntu-latest
     steps:
       - uses: actions/checkout@v2
       - name: Cache node_modules
         uses: actions/cache@v1
         with:
           path: ~/.npm
           key: ${{ runner.os }}-node-${{ hashfiles('**/package-lock.json') }} 
           restore-keys:
             ${{ runner.os }}-node-
      
       - name: Use NodeJS
         uses: actions/setup-node@v1
         with:
           node-version: "12.x"

       - name: Uses node version
         uses: actions/setup-node@v1
         with: 
          node-version: "12.x"
       - run: npm ci
      #  - run: npm run format:check
       - run: npm test   
         env:
          CI: true
       - name: Build Project
         if: github.event_name == 'push'
         run: npm run build
       
       - name: Upload build
         if: github.event_name == 'push'
         uses: actions/upload-artifact@v1
         with:
           name: build
           path: build
         
       - name: Install surge
         run: npm install --global surge  

       - name: Deploy staging
         if: github.event_name == 'push'
         run: npx surge --project ./build --domain silent-apparatus.surge.sh
         env: 
           SURGE_LOGIN: ${{ secrets.SURGE_LOGIN }}
           SURGE_TOKEN: ${{ secrets.SURGE_TOKEN }}



      #  - uses: actions/checkout@v2
      #  - name: Set up JDK 1.8
      #    uses: actions/setup-java@v1
      #    with:
      #     java-version: 1.8   
 
      #  - uses: https://github.com/dwivedinalin/serenity-cucumber-nalin 
      #  - name: Run automated test of Selenium
      #    run: mvn clean verify
         
             